# Anno API â€” auto-TLS via Caddy
# Replace {$ANNO_DOMAIN} with your actual domain or set it as an env var

{$ANNO_DOMAIN:anno.evolvingintelligence.ai} {
	# Reverse proxy to Anno container
	reverse_proxy localhost:5213 {
		# Health checks
		health_uri /health
		health_interval 30s
		health_timeout 10s

		# Timeouts for long-running extraction requests
		transport http {
			response_header_timeout 120s
			dial_timeout 10s
		}
	}

	# Security headers
	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		Referrer-Policy strict-origin-when-cross-origin
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		-Server
	}

	# Request size limit (10MB should be plenty)
	request_body {
		max_size 10MB
	}

	# Access logging
	log {
		output file /var/log/caddy/anno-access.log {
			roll_size 10mb
			roll_keep 5
		}
	}
}

# Landing page (same server, main domain)
{$LANDING_DOMAIN:evolvingintelligence.ai}, {$LANDING_WWW:www.evolvingintelligence.ai} {
	root * /var/www/landing
	file_server

	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		-Server
	}

	log {
		output file /var/log/caddy/landing-access.log {
			roll_size 10mb
			roll_keep 5
		}
	}
}
